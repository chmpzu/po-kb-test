<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PO Knowledge Base</title>
  <style>
    :root {
      --primary: #333333;
      --accent: #ffb900;
      --text: #4a4a4a;
      --bg: #f5f5f5;
      --header-height: 60px;
    }
    * { box-sizing: border-box; }
    body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); }
    header {
      position: fixed; top: 0; left: 0; right: 0; height: var(--header-height);
      background: #fff; border-bottom: 1px solid #ddd; display: flex; align-items: center;
      padding: 0 1rem; z-index: 1000;
    }
    header img { height: 40px; margin-right: 1rem; }
    header h1 { margin: 0; font-size: 1.25rem; color: var(--primary); }
    .search-wrapper { position: relative; margin-left: auto; }
    #searchInput {
      padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc;
      border-radius: 4px; width: 200px;
    }
    #searchResults {
      position: absolute; top: 110%; left: 0; right: 0;
      background: #fff; border: 1px solid #ccc; border-radius: 4px;
      list-style: none; margin: 0; padding: 0; max-height: 250px; overflow-y: auto;
      z-index: 1001;
    }
    #searchResults li {
      padding: 0.5rem; cursor: pointer;
    }
    #searchResults li:hover { background: var(--bg); }
    nav { position: fixed; top: var(--header-height); left: 0; bottom: 0; width: 220px; background: var(--primary); padding: 1rem; overflow-y: auto; }
    nav h3 { color: var(--accent); margin: 0 0 1rem; font-size: 1rem; }
    nav a { display: block; color: #fff; text-decoration: none; padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem; transition: background 0.2s; }
    nav a:hover { background: var(--accent); color: var(--primary); }
    .container { display: flex; margin-top: var(--header-height); }
    #detail-view { flex: 1; padding: 2rem; margin-left: 220px; margin-right: 320px; background: #fff; }
    #announcement-panel { position: fixed; top: var(--header-height); right: 0; bottom: 0; width: 300px; background: #fff; border-left: 1px solid #ddd; padding: 1rem; overflow-y: auto; }
    h2 { margin-top: 0; color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 0.5rem; }
    h3.section { margin-top: 2rem; color: var(--primary); font-size: 1.1rem; border-bottom: 1px solid #ddd; padding-bottom: 0.25rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ddd; padding: 0.75rem; text-align: left; }
    .cards-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
    .card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 1.25rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
    .badge { display: inline-block; background: var(--primary); color: #fff; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; padding: 0.25rem 0.75rem; border-radius: 12px; align-self: center; margin-bottom: 0.75rem; }
    .card h4 { margin: 0 0 0.5rem; color: var(--primary); font-size: 1rem; }
    .description { flex: 1; font-size: 0.875rem; line-height: 1.4; color: var(--text); margin-bottom: 1rem; }
    .actions { display: flex; gap: 1rem; }
    .actions a { text-decoration: none; font-size: 0.875rem; font-weight: 600; color: var(--primary); display: inline-flex; align-items: center; }
    .actions a::after { content: '→'; margin-left: 0.25rem; }
    .actions a:hover { color: var(--accent); }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
</head>
<body>
  <header>
    <img src="/mnt/data/c989c696-b542-4bf6-91df-5ff482249ad3.png" alt="Karparts360 Logo">
    <h1>PO Knowledge Base</h1>
    <div class="search-wrapper">
      <input id="searchInput" type="search" placeholder="Search KB...">
      <ul id="searchResults"></ul>
    </div>
  </header>
  <nav>
    <h3>Navigate</h3>
    <a href="#dashboard">Dashboard</a>
    <a href="#email">Email Templates</a>
    <a href="#trackers">Trackers</a>
    <a href="#ratings">Marketplace Ratings</a>
    <a href="#sops">SOPs</a>
    <a href="#reports">Reports</a>
    <a href="#suppliers">Supplier Contacts</a>
    <a href="#tasks">Task List</a>
    <a href="#processors">Processor Roles</a>
  </nav>
  <div class="container">
    <div id="detail-view">
      <h2>Welcome</h2>
      <p>Select a section from the navigation to view details here.</p>
    </div>
    <aside id="announcement-panel">
      <h2>Announcements</h2>
      <ul>
      </ul>
    </aside>
  </div>

   <!-- Hidden templates -->
  <div id="templates" style="display:none;">
    <div data-template="dashboard">
      <h2>Dashboard</h2>
      <p>Overview of quick links and recent updates.</p>
    </div>
    <div data-template="email">
      <h2>Email Templates</h2>
      <ul><li>Customer Outreach</li><li>Internal Notifications</li><li>Supplier Requests</li></ul>
      <p><em>Use the submit form to suggest new templates.</em></p>
    </div>
    <div data-template="trackers">
      <h2>Trackers</h2>
      <ul><li>Order Fulfillment Status</li><li>Inventory Levels</li><li>Marketing Campaign Performance</li></ul>
    </div>
    <div data-template="ratings">
      <h2>Marketplace Performance Ratings</h2>
      <p>Visual KPIs and scorecards for seller ratings, return rates, on-time delivery.</p>
    </div>
    <div data-template="sops">
      <h2>Standard Operating Procedures (SOPs)</h2>
      <ul><li>Sales</li><li>Procurement</li><li>Logistics</li><li>Customer Service</li></ul>
    </div>
    <div data-template="reports">
      <h2>Reports</h2>
      <table><thead><tr><th>Report</th><th>Frequency</th><th>Owner</th></tr></thead>
      <tbody><tr><td>Sales Dashboard</td><td>Daily</td><td>Sales Team</td></tr>
      <tr><td>P&L Report</td><td>Monthly</td><td>Finance</td></tr></tbody></table>
    </div>
    <div data-template="suppliers">
      <h2>Supplier Contacts</h2>
      <table><thead><tr><th>Supplier</th><th>Contact</th><th>Email</th><th>Phone</th><th>Region</th><th>Status</th></tr></thead>
      <tbody><tr><td>Example Co.</td><td>Jane Doe</td><td>jane@example.com</td><td>+1 555-0100</td><td>NA</td><td>Active</td></tr></tbody></table>
    </div>
    <div data-template="tasks">
      <h2>Task List</h2>
      <p>Kanban board view with Backlog, In Progress, Review, Done.</p>
    </div>
    <div data-template="processors">
      <h2>Processor Roles</h2>
      <h3 class="section">PO Related Tools</h3>
      <div class="cards-container">
        <div class="card">
          <span class="badge">PO</span>
          <h4>PO Scrubbing Tool</h4>
          <p class="description">Cleans and validates purchase orders before processing.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
        <div class="card">
          <span class="badge">PO</span>
          <h4>Ordering File Generator</h4>
          <p class="description">Prepares and formats files for seamless NetSuite PO imports.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
        <div class="card">
          <span class="badge">PO</span>
          <h4>NetSuite Importing Tool</h4>
          <p class="description">Automates the import of POs into NetSuite with mapping support.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
      </div>
      <h3 class="section">Label Related Tools</h3>
      <div class="cards-container">
        <div class="card">
          <span class="badge">Label</span>
          <h4>Order Tagging Tool</h4>
          <p class="description">Tags orders for categorization and processing.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
        <div class="card">
          <span class="badge">Label</span>
          <h4>NPM Calculator Tool</h4>
          <p class="description">Calculates net profit margins for parts.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
        <div class="card">
          <span class="badge">Label</span>
          <h4>ZS File Sorter</h4>
          <p class="description">Sorts ZS files for label printing workflows.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
      </div>
      <h3 class="section">Shipment Related Tools</h3>
      <div class="cards-container">
        <div class="card">
          <span class="badge">Shipment</span>
          <h4>International Address Sweeping Tool</h4>
          <p class="description">Validates and formats international shipping addresses.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
        <div class="card">
          <span class="badge">Shipment</span>
          <h4>Multishipment Tool</h4>
          <p class="description">Bundles multiple shipments into single orders for efficiency.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
      </div>
      <h3 class="section">Inventory Related Tools</h3>
      <div class="cards-container">
        <div class="card">
          <span class="badge">Inventory</span>
          <h4>KSI Inventory Generator</h4>
          <p class="description">Generates inventory reports from KSI data.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
      </div>
      <h3 class="section">Others</h3>
      <div class="cards-container">
        <div class="card">
          <span class="badge">Other</span>
          <h4>Carrier Count Tool</h4>
          <p class="description">Counts carriers and tracks usage metrics.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
        <div class="card">
          <span class="badge">Other</span>
          <h4>Amazon Logistics Count Tool</h4>
          <p class="description">Tracks Amazon logistics performance metrics.</p>
          <div class="actions"><a href="#">View Tool</a><a href="#">View Tutorial</a></div>
        </div>
      </div>
    </div>
    <div data-template="ann-1">
      <h2>System Maintenance</h2>
      <p>Scheduled maintenance on Saturday, May 30th from 2:00–4:00 AM UTC. Services may be intermittent.</p>
    </div>
    <div data-template="ann-2">
      <h2>New SOP Published</h2>
      <p>Our updated Receiving SOP is now live under <em>SOPs → Logistics</em>. Please review by end of week.</p>
    </div>
  </div>
<script>
  // ─── Helpers ────────────────────────────────────────────────────────────────
  /** Turn Google’s Date(yyyy,mm,dd,hh,mi,ss) into a JS Date */
  function parseGoogleDate(str) {
    const m = /^Date\(([\d,]+)\)$/.exec(str);
    if (!m) return new Date(str);
    const [year, month, day, hour, min, sec] = m[1].split(',').map(n => +n);
    return new Date(year, month, day, hour, min, sec);
  }

  /** Format a Date as MM/DD/YYYY hh:mm AM/PM */
  function formatTimestamp(d) {
    const MM   = String(d.getMonth()+1).padStart(2,'0');
    const DD   = String(d.getDate()).padStart(2,'0');
    const YYYY = d.getFullYear();
    let   h    = d.getHours();
    const ampm = h < 12 ? 'AM' : 'PM';
    h = h % 12 || 12;
    const hh = String(h).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    return `${MM}/${DD}/${YYYY} ${hh}:${mm} ${ampm}`;
  }

  // ─── fetchSheet: hit gviz/tq ────────────────────────────────────────────────
  const SHEET_ID = '1zWuPjF-bTWWRTtbs9BLWJk3w4h7Xrpi5oqyUbi6Oqrg';
  function fetchSheet(tab) {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq`
              + `?sheet=${encodeURIComponent(tab)}&tqx=out:json`;
    return fetch(url)
      .then(r => r.text())
      .then(text => {
        const table = JSON.parse(text.substr(47).slice(0, -2)).table;
        return table.rows.map(rw => rw.c.map(cell => cell && cell.v));
      });
  }

  // ─── loadPOKB: load all sections ────────────────────────────────────────────
  async function loadPOKB() {
    // ==== Announcements ====
    try {
      const rows = await fetchSheet('Announcements');
      console.log('Announcements rows:', rows);
      const ul = document.querySelector('#announcement-panel ul');
      ul.innerHTML = '';

      if (rows.length === 0) {
        ul.innerHTML = '<li class="text-gray-500 italic">No announcements.</li>';
      } else {
        rows.forEach((r, i) => {
          // r = [ rawTime, name, content ]
          const raw = r[0],
                dateObj = (typeof raw === 'string' && raw.startsWith('Date('))
                          ? parseGoogleDate(raw)
                          : new Date(raw),
                time    = formatTimestamp(dateObj),
                name    = r[1],
                content = r[2],
                id      = `ann-${i}`;

          ul.innerHTML += `
            <li>
              <span class="ann-time">${time}</span>
              <a href="#${id}" class="ann-link">${name}</a>
            </li>`;

          let tpl = document.querySelector(`[data-template="${id}"]`);
          if (!tpl) {
            tpl = document.createElement('div');
            tpl.dataset.template = id;
            document.getElementById('templates').appendChild(tpl);
          }
          tpl.innerHTML = `
            <h2>${name}</h2>
            <small>${time}</small>
            <p>${content}</p>`;
        });
      }
    } catch (err) {
      console.error('Error loading Announcements:', err);
    }

// ==== Email Templates ====
try {
  const rows = await fetchSheet('Email Templates');
  const data = rows.slice(1);          // drop header
  const container = document.querySelector('[data-template="email"]');
  container.innerHTML = '<h2>Email Templates</h2>';

  // group by category
  const groups = {};
  data.forEach(([cat,name,content]) => {
    (groups[cat] = groups[cat]||[]).push({ name, content });
  });

  // render
  Object.entries(groups).forEach(([cat, items]) => {
    const h3 = document.createElement('h3');
    h3.className = 'section';
    h3.textContent = cat.toUpperCase();
    container.append(h3);

    const ul = document.createElement('ul');
    items.forEach(item => {
      const li = document.createElement('li');
      const a  = document.createElement('a');
      a.href = '#';
      a.textContent = item.name;
      a.style.cursor = 'pointer';

      // HERE we refer to our globally created overlay, titleEl, bodyEl:
      a.addEventListener('click', e => {
        e.preventDefault();
        document.getElementById('email-modal-title').textContent = item.name;
        document.getElementById('email-modal-body').innerHTML  = item.content;
        overlay.style.display = 'flex';
      });

      li.append(a);
      ul.append(li);
    });
    container.append(ul);
  });
} catch (err) {
  console.error('Error loading Email Templates:', err);
}

    // ==== SOPs ====
    try {
      const rows = await fetchSheet('SOPs');
      const div  = document.querySelector('[data-template="sops"]');
      div.innerHTML = '<h2>SOPs</h2><ul>' +
        rows.map(r => `<li><a href="${r[2]}" target="_blank">${r[1]}</a></li>`).join('') +
        '</ul>';
    } catch (e) { console.error('SOPs error:', e); }

    // ==== Trackers ====
    try {
      const rows = await fetchSheet('Trackers');
      const div  = document.querySelector('[data-template="trackers"]');
      div.innerHTML = '<h2>Trackers</h2><ul>' +
        rows.map(r => `<li><a href="${r[2]}" target="_blank">${r[1]}</a></li>`).join('') +
        '</ul>';
    } catch (e) { console.error('Trackers error:', e); }

    // ==== Supplier Contacts ====
    try {
      const rows = await fetchSheet('Supplier Contacts');
      const tbody = document.querySelector('[data-template="suppliers"] tbody');
      tbody.innerHTML = rows.map(r => `
        <tr>
          <td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>
          <td>${r[3]}</td><td>${r[4]}</td><td>${r[5]}</td>
        </tr>`).join('');
    } catch (e) { console.error('Suppliers error:', e); }

    // ==== Re-bind announcement clicks ====
    document.querySelectorAll('.ann-link').forEach(link => {
      link.onclick = e => {
        e.preventDefault();
        const key = link.getAttribute('href').slice(1);
        const tmpl = document.querySelector(`[data-template="${key}"]`);
        if (tmpl) document.getElementById('detail-view').innerHTML = tmpl.innerHTML;
      };
    });
  }

document.addEventListener('DOMContentLoaded', () => {
  // ─── 1) Build modal overlay ───────────────────────────────────────────────
  const overlay = document.createElement('div');
  overlay.id = 'email-modal-overlay';
  Object.assign(overlay.style, {
    position:       'fixed',
    top:            0, left: 0, right: 0, bottom: 0,
    background:     'rgba(0,0,0,0.5)',
    display:        'none',
    justifyContent: 'center',
    alignItems:     'center',
    padding:        '2rem',
    boxSizing:      'border-box',
    overflowY:      'auto',
    zIndex:         '10000'
  });

  const dialog = document.createElement('div');
  Object.assign(dialog.style, {
    background:     '#fff',
    padding:        '1rem',
    borderRadius:   '8px',
    maxWidth:       '600px',
    width:          '90%',
    boxSizing:      'border-box',
    display:        'flex',
    flexDirection:  'column'
  });

  // Header row with title + close button
  const hdr = document.createElement('div');
  Object.assign(hdr.style, {
    display:        'flex',
    justifyContent: 'space-between',
    alignItems:     'center',
    marginBottom:   '.5rem'
  });

  const titleEl = document.createElement('h3');
  titleEl.id = 'email-modal-title';
  titleEl.style.margin = 0;
  titleEl.style.fontSize = '1.25rem';

  const closeBtn = document.createElement('button');
  closeBtn.innerHTML = '&times;';
  Object.assign(closeBtn.style, {
    background: 'none',
    border:     'none',
    fontSize:   '1.5rem',
    cursor:     'pointer'
  });
  closeBtn.addEventListener('click', () => overlay.style.display = 'none');

  hdr.append(titleEl, closeBtn);
  dialog.append(hdr);

  // Copy button
  const copyBtn = document.createElement('button');
  copyBtn.textContent = 'Copy';
  Object.assign(copyBtn.style, {
    alignSelf:    'flex-end',
    marginBottom: '.5rem',
    cursor:       'pointer'
  });
  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(bodyEl.innerText)
      .then(() => {
        copyBtn.textContent = 'Copied!';
        setTimeout(() => copyBtn.textContent = 'Copy', 1500);
      });
  });
  dialog.append(copyBtn);

  // Body container
  const bodyEl = document.createElement('div');
  bodyEl.id = 'email-modal-body';
  Object.assign(bodyEl.style, {
    whiteSpace:   'pre-wrap',
    wordBreak:    'break-word'
  });
  dialog.append(bodyEl);

  overlay.append(dialog);
  document.body.append(overlay);

  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(bodyEl.innerText).then(() => {
      copyBtn.textContent = 'Copied!';
      setTimeout(() => copyBtn.textContent = 'Copy', 1500);
    });
  });

  // ─── 2) Sheet loader helpers ────────────────────────────────────────────────
  function fetchSheet(tab) {
    const SHEET_ID = '1zWuPjF-bTWWRTtbs9BLWJk3w4h7Xrpi5oqyUbi6Oqrg';
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq`
              + `?sheet=${encodeURIComponent(tab)}&tqx=out:json`;
    return fetch(url)
      .then(r => r.text())
      .then(text => {
        const table = JSON.parse(text.substr(47).slice(0,-2)).table;
        return table.rows.map(rw => rw.c.map(cell => cell && cell.v));
      });
  }
  function parseGoogleDate(str) {
    const m = /^Date\(([\d,]+)\)$/.exec(str);
    if (!m) return new Date(str);
    const [y,mo,d,h,mi,s] = m[1].split(',').map(n=>+n);
    return new Date(y,mo,d,h,mi,s);
  }
  function formatTimestamp(dt) {
    const MM   = String(dt.getMonth()+1).padStart(2,'0');
    const DD   = String(dt.getDate()).padStart(2,'0');
    const YYYY = dt.getFullYear();
    let h = dt.getHours(), ampm = h<12?'AM':'PM';
    h = h%12||12;
    const hh = String(h).padStart(2,'0'),
          mm = String(dt.getMinutes()).padStart(2,'0');
    return `${MM}/${DD}/${YYYY} ${hh}:${mm} ${ampm}`;
  }

  // ─── 3) Load everything ────────────────────────────────────────────────────
  async function loadPOKB() {
    // Announcements
    try {
      const rows = await fetchSheet('Announcements');
      const ul   = document.querySelector('#announcement-panel ul');
      ul.innerHTML = '';
      if (!rows.length) {
        ul.innerHTML = '<li class="text-gray-500 italic">No announcements.</li>';
      } else {
        rows.forEach((r,i) => {
          const raw    = r[0],
                dtObj  = typeof raw==='string' && raw.startsWith('Date(')
                       ? parseGoogleDate(raw)
                       : new Date(raw),
                time   = formatTimestamp(dtObj),
                name   = r[1],
                content= r[2],
                id     = `ann-${i}`;
          const li = document.createElement('li');
          li.innerHTML = 
            `<span class="ann-time">${time}</span>
             <a href="#${id}" class="ann-link">${name}</a>`;
          ul.append(li);
          let tpl = document.querySelector(`[data-template="${id}"]`);
          if (!tpl) {
            tpl = document.createElement('div');
            tpl.dataset.template = id;
            document.getElementById('templates').append(tpl);
          }
          tpl.innerHTML = `<h2>${name}</h2>
                           <small>${time}</small>
                           <p>${content}</p>`;
        });
      }
      document.querySelectorAll('.ann-link').forEach(a =>
        a.addEventListener('click', e => {
          e.preventDefault();
          const key = a.getAttribute('href').slice(1),
                t   = document.querySelector(`[data-template="${key}"]`);
          if (t) document.getElementById('detail-view').innerHTML = t.innerHTML;
        })
      );
    } catch(e){ console.error(e); }

    // Email Templates
    try {
      const rows = (await fetchSheet('Email Templates')).slice(1);
      const container = document.querySelector('[data-template="email"]');
      container.innerHTML = '<h2>Email Templates</h2>';
      const groups = {};
      rows.forEach(([cat,name,content]) => {
        (groups[cat]=groups[cat]||[]).push({name,content});
      });
      Object.entries(groups).forEach(([cat,items]) => {
        const h3 = document.createElement('h3');
        h3.className = 'section';
        h3.textContent = cat.toUpperCase();
        container.append(h3);
        const ul = document.createElement('ul');
        items.forEach(item => {
          const li = document.createElement('li'),
                a  = document.createElement('a');
          a.href = '#';
          a.textContent = item.name;
          a.style.cursor = 'pointer';
          a.addEventListener('click', e => {
            e.preventDefault();
            titleEl.textContent = item.name;
            bodyEl.innerHTML    = item.content;
            overlay.style.display = 'flex';
          });
          li.append(a);
          ul.append(li);
        });
        container.append(ul);
      });
    } catch(e){ console.error(e); }

    // SOPs, Trackers, Suppliers (similar pattern)…
    // [You can fill those in as before, they’re unchanged.]
  }

  // ─── 4) Search + nav + kick-off ───────────────────────────────────────────
  // build Fuse index
  const items = [];
  document.querySelectorAll('nav a').forEach(a =>
    items.push({key:a.hash.slice(1),title:a.textContent.trim()})
  );
  document.querySelectorAll('#templates [data-template]').forEach(div => {
    const h2 = div.querySelector('h2');
    if (h2) items.push({key:div.dataset.template,title:h2.textContent.trim()});
  });
  const fuse = new Fuse(items,{keys:['title'],threshold:0.3});

  // search box
  const inp = document.getElementById('searchInput'),
        res = document.getElementById('searchResults');
  inp.addEventListener('input', () => {
    const q = inp.value.trim();
    res.innerHTML = '';
    if (!q) return;
    fuse.search(q,{limit:10}).forEach(m => {
      const li = document.createElement('li');
      li.textContent = m.item.title;
      li.addEventListener('click', () => {
        const tpl = document.querySelector(`[data-template="${m.item.key}"]`);
        if (tpl) document.getElementById('detail-view').innerHTML = tpl.innerHTML;
        res.innerHTML = '';
        inp.value = '';
      });
      res.append(li);
    });
  });

  // nav clicks
  document.querySelectorAll('nav a').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const tpl = document.querySelector(`[data-template="${link.hash.slice(1)}"]`);
      if (tpl) document.getElementById('detail-view').innerHTML = tpl.innerHTML;
    });
  });

  // finally, fetch data
  loadPOKB();
});
   
</script>
</body>
</html>
